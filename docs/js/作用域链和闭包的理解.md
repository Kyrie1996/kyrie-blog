# 作用域链和闭包的理解

### 词法作用域
词法作用域就是指作用域是由代码中函数声明的位置来决定的，所以词法作用域是静态的作用域，通过它就能够预测代码在执行过程中如何查找标识符。
(注：词法作用域是代码阶段就决定好的，和函数是怎么调用的没有关系。)

### 作用域链
在每个执行上下文的变量环境中，都包含了一个外部引用，用来指向外部的执行上下文，我们把这个外部引用称为outer。当一段代码使用了一个变量时，JavaScript 引擎首先会在“当前的执行上下文”中查找该变量，如果在当前的变量环境中没有查找到，那么JavaScript 引擎会继续在 outer 所指向的执行上下文中查找。我们把这个查找的链条就称为作用域链。


#### 示例
``` javascript
  function bar() {
    console.log(myName)
  }
  function foo() {
    var myName = " fooName "
    bar()
  }
  var myName = " hello "
  foo()

```
根据词法作用域，foo 和 bar 的上级作用域都是全局作用域，所以如果 foo 或者bar 函数使用了一个它们没有定义的变量，那么它们会到全局作用域去查找。也就是说，`词法作用域是代码阶段就决定好的，和函数是怎么调用的没有关系。`

### 闭包(Closure)
在 JavaScript 中，根据词法作用域的规则，内部函数总是可以访问其外部函数中声明的变量，`当通过调用一个外部函数返回一个内部函数后`，即使该外部函数已经执行结束了，但是内部函数引用外部函数的变量依然保存在内存中，我们就把这些变量的集合称为闭包。比如外部函数是 foo，那么这些变量的集合就称为 foo 函数的闭包。

社区中对闭包的定义: 函数执行产生私有作用域, 函数内部返回一个调用的函数, 由于外部会拿到内部函数的返回值, 所以内部函数不会被垃圾回收, 这个私有作用域就是闭包.
闭包的作用有两点: 
1. 保护私有变量 
2. 维持内部私有变量的状态
  #### 闭包是怎么回收的
  通常，如果引用闭包的函数是一个全局变量，那么闭包会一直存在直到页面关闭；但如果这个闭包以后不再使用的话，就会造成内存泄漏。如果引用闭包的函数是个局部变量，等函数销毁后，在下次 JavaScript 引擎执行垃圾回收时，判断闭包这块内容如果已经不再被使用了，那么 JavaScript 引擎的垃圾回收器就会回收这块内存如果该闭包会一直使用，那么它可以作为全局变量而存在；但如果使用频率不高，而且占用内存又比较大的话，那就尽量让它成为一个局部变量。

<!-- ![节点](./jd.png)  -->